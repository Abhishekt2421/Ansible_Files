---
- name: Test connectivity to servers
  hosts: localhost   # Replace with your inventory group or hostname
  gather_facts: false
  collections:
    - community.general

  tasks:
    - name: GET request
      ansible.builtin.uri:
        url: https://fakerestapi.azurewebsites.net/api/v1/Activities
    - name: GET request 2
      ansible.builtin.uri:
        url: https://fakerestapi.azurewebsites.net/api/v1/Activities/
        method: GET
        status_code: 200
        return_content: true
      register: API_output
    - name : Display the value to fail
      ansible.builtin.set_fact:
        varout : API_output.json
    # - name: Initialize variable1
    #   ansible.builtin.set_fact:
    #     variable1: []

    - name: Display each API activity
      ansible.builtin.debug:
        msg: "ID={{ item.id | default(item.Id) }} Title={{ item.title | default(item.Title) }} Due={{ item.dueDate | default(item.DueDate) }} Completed={{ item.completed | default(item.Completed) }}"
      loop: "{{ API_output.json }}"
      loop_control:
        loop_var: item

    - name: Append each activity to variable1
      ansible.builtin.set_fact:
        variable1: "{{ (variable1 | default([])) + [ { 'ID': (item.id | default(item.Id)), 'Title': (item.title | default(item.Title)), 'Due': (item.dueDate | default(item.DueDate)), 'Completed': (item.completed | default(item.Completed)) } ] }}"
      loop: "{{ API_output.json | default([]) }}"

 
    






